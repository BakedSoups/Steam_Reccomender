{% extends 'base.html' %}

{% block title %}Select Your Game Preferences{% endblock %}

{% block body_class %}dark-theme{% endblock %}

{% block content %}
    <div class="top-banner">
        <div class="app-logo">
            <a href="{{ url_for('index') }}">
                <img src="{{ url_for('static', filename='logo.png') }}" alt="Steam Game Recommender">
            </a>
        </div>
        <div class="app-header">
            <h1>Steam Game Recommender</h1>
            <a href="{{ url_for('index') }}" class="home-button">Home</a>
        </div>
    </div>

    <div class="preference-container backdrop-blur-sm">
        <div class="reference-game hover:shadow-lg transition-all duration-300">
            <img src="{{ reference_game.header_image if reference_game.header_image else url_for('static', filename='logo.png') }}" alt="{{ reference_game.name }}" class="game-image">
            <div class="game-info">
                <h2 class="text-steam-blue">{{ reference_game.name }}</h2>
                <p>{{ reference_game.main_genre }}</p>
                {% if reference_game.description %}
                    <p>{{ reference_game.description[:150] }}{% if reference_game.description|length > 150 %}...{% endif %}</p>
                {% endif %}
            </div>
        </div>

        <h2 class="preference-title">What aspects of this game matter most to you?</h2>
        <p class="info-text">Select a gameplay element that you want to see in your recommendations</p>

        <form action="{{ url_for('recommend') }}" method="post" id="preferenceForm">
            <div class="tag-list">
                {% for tag, ratio in tag_ratios.items() %}
                    <div class="tag-item group hover:-translate-y-1 hover:shadow-lg transition-all duration-300" data-tag="{{ tag }}">
                        <input type="radio" name="preferred_tag" value="{{ tag }}" id="tag_{{ tag }}" style="display: none;" required>
                        <span class="tag-name whitespace-nowrap overflow-hidden text-ellipsis min-w-0">{{ tag|title }}</span>
                        <div class="tag-bar">
                            <div class="bar-fill group-hover:shadow-steam-blue/50" style="width: {{ ratio }}%"></div>
                        </div>
                        <span class="tag-ratio whitespace-nowrap">{{ ratio }}%</span>
                    </div>
                {% endfor %}
            </div>

            {% if unique_tags %}
            <div class="unique-tags-container bg-steam-blue-dark/40 backdrop-blur-sm">
                <div class="unique-tags-title text-steam-blue-light font-medium">Unique features of this game:</div>
                <div class="unique-tags">
                    {% for tag in unique_tags %}
                        <span class="unique-tag hover:-translate-y-1 hover:bg-steam-blue transition-all duration-300">{{ tag }}</span>
                    {% endfor %}
                </div>
            </div>
            {% endif %}

            <div class="button-container">
                <button type="submit" class="continue-button hover:bg-sky-500 hover:-translate-y-1 transition-all duration-300">Find Similar Games</button>
            </div>
        </form>
    </div>

    <script>
        // Make the tag items selectable
        document.querySelectorAll('.tag-item').forEach(item => {
            item.addEventListener('click', function() {
                // Remove selection from all items
                document.querySelectorAll('.tag-item').forEach(i => {
                    i.classList.remove('selected');
                });
                
                // Add selection to clicked item
                this.classList.add('selected');
                
                // Check the radio button
                const tag = this.getAttribute('data-tag');
                document.getElementById('tag_' + tag).checked = true;
            });
        });
        
        // Auto-select the first tag by default
        document.addEventListener('DOMContentLoaded', function() {
            const firstTag = document.querySelector('.tag-item');
            if (firstTag) {
                firstTag.click();
            }
        });
    </script>
{% endblock %}